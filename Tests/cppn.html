<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

    <title>CPPN Demo</title>
    <style>
        body  {
            margin: 0; padding: 0;
        }
    </style>
    <script type="text/javascript" src="../Support/loadhack.js"></script>
    <script type='text/javascript' src='../Support/jkl-parsexml.js'></script>
    <script type="text/javascript" src="../Helpers.js"></script>
    <script type="text/javascript" src="../Maths.js"></script>
    <script type="text/javascript" src="../ActivationFunctions.js"></script>
    <script type="text/javascript" src="../CPPN.js"></script>
    <script type="text/javascript" src="CPPNTests.js"></script>
    <script type='text/javascript' src='../Support/Decoding.js'></script>
    <script type='text/javascript'>

        window.onload = function()
        {
            //this is hack init
            ensureParserExists();

        var url = "genomeTest.xml";
        //var xmlData = importXML(url);

           // Check for the various File API support.
            if (window.File && window.FileReader && window.FileList && window.Blob) {
                // Great success! All the File APIs are supported.
                console.log("Can open files using filestuff");

                function handleFileSelect(evt) {
                    var files = evt.target.files; // FileList object

                    // Loop through the FileList
                    for (var i = 0, f; f = files[i]; i++) {

                        var reader = new FileReader();

                        // Closure to capture the file information.
                        reader.onload = (function(theFile) {
                            return function(e) {
                                // Print the contents of the file

                                var parser=new DOMParser();
                                var doc=parser.parseFromString(e.target.result,"text/xml");
                                console.log(doc);

                                var xml = new JKL.ParseXML();
                                var xd =  xml.parseDocument(doc);
                                console.log(xd["#document"]);

                                var genome = xd["#document"].TestDoc.genome;

                                console.log(Decoding.CPPNFromJSON(genome, Decoding.CPPNTypes.Concurrent))

                                testsNS.CPPNTests(xd["#document"].TestDoc);
                               // console.log(typeof xd["#document"].TestDoc.results.result[0].r2);

                                //var span = document.createElement('span');
                                //span.innerHTML = ['<p>',e.target.result,'</p>'].join('');
                                //document.getElementById('list').insertBefore(span, null);
                            };
                        })(f);

                        // Read in the file
                        //reader.readAsDataText(f,UTF-8);
                        reader.readAsText(f,"UTF-8");
                    }
                }

                document.getElementById('files').addEventListener('change', handleFileSelect, false);


            } else {

                try
                {
                    var xml = new JKL.ParseXML( url );

                    var data = xml.parse();

                    console.log(data);

                }
                catch(error)
                {
                alert('No support for local files on your browser. You need a newer browser, you need to relax your chrome settings, or you have to launch a local server.');
             }
        }
        }


    </script>
</head>
<body>
    <div id="xmlInput">
        <input type="file" id="files" name="files[]" multiple/>
    </div>

</body>
</html>